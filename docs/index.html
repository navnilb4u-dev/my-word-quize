<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Flashcard Spelling Checker - Pages</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; }
  .flashcard { max-width: 400px; margin: auto; text-align: center; }
  .word { font-size: 2.5em; margin: 20px 0; }
  #counter { font-size: 1.2em; margin-bottom: 10px; }
  input[type="text"] { font-size: 1.4em; padding: 5px; width: 100%; }
  button { padding: 10px 20px; margin-top: 10px; font-size: 1em; }
  .result { margin-top: 15px; font-weight: bold; font-size: 1.3em; }
  .correct { color: green; }
  .incorrect { color: red; }
  #pronounceBreakdown { margin-top: 8px; font-size: 1.1em; font-style: italic; color: #666; }
  .controls { margin-bottom: 20px; }
</style>
</head>
<body>

<div class="flashcard">
  <div class="controls">
    <label for="pageSelect">Choose page: </label>
    <select id="pageSelect"></select>
  </div>
  <div id="counter"></div>
  <div class="word" id="wordDisplay"></div>
  <button id="speakBtn">ðŸ”Š Listen</button>
  <input type="text" id="spellingInput" placeholder="Type the spelling here" autocomplete="off" />
  <button id="checkBtn">Check Spelling</button>
  <div class="result" id="resultDisplay"></div>
  <div id="pronounceBreakdown"></div>
  <button id="nextBtn" style="display:none;">Next Word</button>
</div>

<script>
  const pages = [
    ["example", "language", "programming", "javascript", "flashcard"],
    ["apple", "banana", "cherry", "date", "elderberry"],
    ["sun", "moon", "star", "planet", "galaxy"]
  ];

  function shuffle(array) {
    for (let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
  }

  const pageSelect = document.getElementById('pageSelect');
  const counter = document.getElementById('counter');
  const wordDisplay = document.getElementById('wordDisplay');
  const speakBtn = document.getElementById('speakBtn');
  const spellingInput = document.getElementById('spellingInput');
  const checkBtn = document.getElementById('checkBtn');
  const resultDisplay = document.getElementById('resultDisplay');
  const pronounceBreakdown = document.getElementById('pronounceBreakdown');
  const nextBtn = document.getElementById('nextBtn');

  let currentPage = 0;
  let words = [];
  let currentIndex = 0;

  // Datamuse API call to get syllables count and breakdown
  async function getDatamusePronunciation(word) {
    try {
      const response = await fetch(`https://api.datamuse.com/words?sp=${word}&md=s`);
      const data = await response.json();
      if (data[0] && data[0].numSyllables) {
        // Just show syllable count, or try to display itself as chunked word:
        return `Syllables: ${data[0].numSyllables}`;
      }
    } catch (e) {
      // fail silently and fallback
    }
    return "Pronunciation info unavailable";
  }

  function populatePages() {
    for (let i = 0; i < pages.length; i++) {
      const option = document.createElement('option');
      option.value = i;
      option.textContent = `Page ${i + 1}`;
      pageSelect.appendChild(option);
    }
  }

  function updateCounter() {
    counter.textContent = `Word ${currentIndex + 1} of ${words.length}`;
  }

  pageSelect.addEventListener('change', () => {
    currentPage = parseInt(pageSelect.value);
    startPage();
  });

  function showWord() {
    spellingInput.value = "";
    resultDisplay.innerHTML = "";
    resultDisplay.className = "result";
    pronounceBreakdown.textContent = "";
    nextBtn.style.display = "none";
    spellingInput.disabled = false;
    checkBtn.disabled = false;
    wordDisplay.textContent = "Spell this word:";
    updateCounter();
  }

  function pronounceWord(word) {
    if ('speechSynthesis' in window) {
      const synth = window.speechSynthesis;
      const voices = synth.getVoices();
      const utterance = new SpeechSynthesisUtterance(word);
      const niceVoice = voices.find(v => v.lang.startsWith('en')) || voices[0];
      utterance.voice = niceVoice;
      utterance.rate = 0.9;
      utterance.pitch = 1.0;
      synth.speak(utterance);
    } else {
      alert('Speech synthesis not supported in this browser.');
    }
  }

  speakBtn.addEventListener('click', () => {
    pronounceWord(words[currentIndex]);
  });

  checkBtn.addEventListener('click', async () => {
    const userSpelling = spellingInput.value.trim().toLowerCase();
    const correctWord = words[currentIndex];

    if (userSpelling === correctWord.toLowerCase()) {
      resultDisplay.innerHTML = `Correct! The spelling is: <strong>${correctWord}</strong>`;
      resultDisplay.className = "result correct";
    } else {
      resultDisplay.innerHTML = `Incorrect. The correct spelling is: <strong>${correctWord}</strong>`;
      resultDisplay.className = "result incorrect";
    }

    // Fetch pronunciation info from Datamuse API
    const phonetic = await getDatamusePronunciation(correctWord);
    pronounceBreakdown.textContent = phonetic;

    spellingInput.disabled = true;
    checkBtn.disabled = true;
    nextBtn.style.display = "inline-block";
  });

  nextBtn.addEventListener('click', () => {
    currentIndex++;
    if (currentIndex >= words.length) {
      startPage();
    } else {
      showWord();
    }
  });

  function startPage() {
    words = shuffle([...pages[currentPage]]);
    currentIndex = 0;
    showWord();
  }

  // Load voices when available
  if (speechSynthesis) {
    speechSynthesis.onvoiceschanged = () => {};
  }

  populatePages();
  pageSelect.selectedIndex = 0;
  startPage();
</script>

</body>
</html>
