<script>
  const pages = [
    ["example", "language", "programming", "javascript", "flashcard", "geranium"],
    ["apple", "banana", "cherry", "date", "elderberry"],
    ["sun", "moon", "star", "planet", "galaxy"]
  ];

  let synth;
  let voices = [];

  function pronounceWord(word) {
    if (!('speechSynthesis' in window)) {
      alert('Speech synthesis not supported');
      return;
    }
    if (voices.length === 0) {
      window.speechSynthesis.onvoiceschanged = () => pronounceWord(word);
      return;
    }
    const utterance = new SpeechSynthesisUtterance(word);
    const niceVoice = voices.find(v => v.lang.startsWith('en-US')) || voices[0];
    utterance.voice = niceVoice;
    utterance.rate = 0.9;
    utterance.pitch = 1.0;
    synth.speak(utterance);
  }

  // Simple syllable breakdown using Hyphenator's run() method
  function getSyllableBreakdown(word) {
    // Create a temporary element for Hyphenator to process
    const tempDiv = document.createElement('div');
    tempDiv.className = 'hyphenate';
    tempDiv.lang = 'en';
    tempDiv.textContent = word;
    document.body.appendChild(tempDiv);
    
    // Run Hyphenator on the element
    Hyphenator.run();
    
    // Get the hyphenated result and replace soft hyphens with visible dots
    const result = tempDiv.textContent.replace(/\u00AD/g, 'Â·');
    document.body.removeChild(tempDiv);
    return result;
  }

  document.addEventListener('DOMContentLoaded', function() {
    // Configure Hyphenator
    Hyphenator.config({
      hyphenchar: '\u00AD',  // soft hyphen
      minwordlength: 4
    });

    synth = window.speechSynthesis;
    voices = synth.getVoices();
    synth.onvoiceschanged = () => {
      voices = synth.getVoices();
    };

    const pageSelect = document.getElementById('pageSelect');
    const counter = document.getElementById('counter');
    const wordDisplay = document.getElementById('wordDisplay');
    const speakBtn = document.getElementById('speakBtn');
    const spellingInput = document.getElementById('spellingInput');
    const checkBtn = document.getElementById('checkBtn');
    const resultDisplay = document.getElementById('resultDisplay');
    const pronounceBreakdown = document.getElementById('pronounceBreakdown');
    const nextBtn = document.getElementById('nextBtn');

    let currentPage = 0;
    let words = [];
    let currentIndex = 0;

    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    function updateCounter() {
      counter.textContent = `Word ${currentIndex + 1} of ${words.length}`;
    }

    pageSelect.addEventListener('change', () => {
      currentPage = parseInt(pageSelect.value);
      startPage();
    });

    function showWord() {
      spellingInput.value = "";
      resultDisplay.innerHTML = "";
      resultDisplay.className = "result";
      pronounceBreakdown.textContent = "";
      nextBtn.style.display = "none";
      spellingInput.disabled = false;
      checkBtn.disabled = false;
      wordDisplay.textContent = "Spell this word:";
      updateCounter();
    }

    speakBtn.addEventListener('click', () => {
      if (words[currentIndex]) {
        pronounceWord(words[currentIndex]);
      }
    });

    checkBtn.addEventListener('click', () => {
      const userSpelling = spellingInput.value.trim().toLowerCase();
      const correctWord = words[currentIndex];
      
      if (correctWord && userSpelling === correctWord.toLowerCase()) {
        resultDisplay.innerHTML = `Correct! The spelling is: <strong>${correctWord}</strong>`;
        resultDisplay.className = "result correct";
      } else if (correctWord) {
        resultDisplay.innerHTML = `Incorrect. The correct spelling is: <strong>${correctWord}</strong>`;
        resultDisplay.className = "result incorrect";
      }

      // Get syllable breakdown
      const syllabified = getSyllableBreakdown(correctWord);
      pronounceBreakdown.innerHTML = `<span class="syllables">${syllabified}</span>`;

      spellingInput.disabled = true;
      checkBtn.disabled = true;
      nextBtn.style.display = "inline-block";
    });

    nextBtn.addEventListener('click', () => {
      currentIndex++;
      if (currentIndex >= words.length) {
        startPage();
      } else {
        showWord();
      }
    });

    function startPage() {
      words = shuffle([...pages[currentPage]]);
      currentIndex = 0;
      showWord();
    }

    // Start the quiz
    startPage();
  });
</script>
